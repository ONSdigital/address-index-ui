{% extends './aims_ui_pages/0-base_page_settings.html' %}

{% from 'components/panel/_macro.njk' import onsPanel %}
{% from 'components/list/_macro.njk' import onsList %}
{% from "components/table/_macro.njk" import onsTable %}
{% from "components/section-navigation/_macro.njk" import onsSectionNavigation %}

{% from 'custom_search/_macro.njk' import customSearch %}
{% from 'custom_address_results_table/_macro.njk' import customAddressResultsTable %}
{% from 'custom_save_addresses_to_client/_macro.njk' import customSaveAddressesToClient %}
{% from 'custom_we_matched_message/_macro.njk' import weMatchedAddressPreamble %}
{% from 'custom_title_and_description/_macro.njk' import customTitleAndDescription %}
{% from 'custom_download_results_from_local_storage/_macro.njk' import customDownloadResultsFromLocalStorage %}
{% from 'custom_additional_request_info/_macro.njk' import customAdditionalRequestInfo %}
{% from 'custom_run_script_with_page_name/_macro.njk' import runScriptWithPageName%}

	{# Title and description #}
	{{ customTitleAndDescription({
		"endpoints": endpoints,
	})}}

{# In order to specify wider than usual components, page must be in "pageContent" #}
{% block pageContent %}
{% block main %}

<link rel="stylesheet" href="static/css/a_single_matches/radiussearch/mapAndResults.css">
<link rel="stylesheet" href="static/css/a_single_matches/radiussearch/inputs.css">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<form method="POST" id="searchform">

<div id="pageContentContainer">
	<div id="centeredContainer">
		{{ customTitleAndDescription({
			"endpoints": endpoints,
		})}}

		{{ customSearch ({ "Fields": searchable_fields,
					"endpoints": endpoints,              
		   		"page_name": page_name,
					"remove_search_button":False,
					"invisible": True,
					"override_clear_filters_button_text": 'Clear All',
					"component_wrappers": True,
					"results_page": results_page, }) }}
		<br>

		<div id="mapAndResultsContainer">

			<div id="mapContainer">
				<div id="map" aria-label="Interactive map"></div>
			</div>

			<div id="resultsContainer">
				<h2>Results:</h2>
				{% if results_page %}
				  {# Save the results to local storage on the clientside #}
						{{ customSaveAddressesToClient({
							"matched_addresses": matched_addresses,
							"responseAttributes": responseAttributes,
							"page_name": page_name,
						}) }}

					{# Add the additional request info from the custom component #}
					{{ customAdditionalRequestInfo({
						"page_name": page_name,
					}) }}
					<br>
					<br>

  			{% endif %}

				{# Add the "We matched {X} addresses" #}
				{{ weMatchedAddressPreamble({
					"page_name": page_name,
				}) }}

				{# Generate table with Live addresses - restore from local storage if not a results page #}
				{{ customAddressResultsTable({
					'matched_addresses': matched_addresses,
					'page_name': page_name,
					'results_page': results_page,
					}) }}

				{{ customDownloadResultsFromLocalStorage({
					"page_name": page_name,
				}) }}

			</div>
		</div>


	</div>
</div>

</form>


<script type=module src="static/js/e_all_pages/all_pages_first_js.mjs"></script>

<!-- Save and load inputs with the new mechanism -->
{{ runScriptWithPageName({
		"page_name": page_name,
		"script_location": '/static/js/e_all_pages/save_and_restore_inputs.mjs',
}) }}

<!-- Load Leaflet JS before page specific scripts that use the interactive map that relies on leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script type=module src="static/js/a_single_matches/radiussearch/init.mjs"></script>
<!-- We do not need custom column widths here as this page's layout is handled by CSS -->

<script type=module src="static/js/e_all_pages/all_pages_last.mjs"></script>

{% endblock %}
{% endblock %}
