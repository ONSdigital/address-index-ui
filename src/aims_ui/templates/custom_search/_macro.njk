{% macro customSearch(params) %}

{% from 'components/input/_macro.njk' import onsInput %}
{% from 'components/select/_macro.njk' import onsSelect %}
{% from "components/checkboxes/_checkbox-macro.njk" import onsCheckbox %}
{% from "components/button/_macro.njk" import onsButton %}
{% from "components/radios/_macro.njk" import onsRadios %}
{% from "components/label/_macro.njk" import onsLabel %}
{% from "components/question/_macro.njk" import onsQuestion %}
{% from "components/autosuggest/_macro.njk" import onsAutosuggest %}

{% set col = namespace(value=-1) %}
{% set row = namespace(value=0) %}
{% set max_col = 1 %}

<section class = "match-form-container" >
{% for field in params.Fields %}

{% if params.results_page %}
{% set show = True %}
{% elif not params.results_page and not field.only_display_in_results_page %}
{% set show = True %}
{% elif not params.results_page and field.only_display_in_results_page %}
{% set show = False %}
{% endif %}


{# Check to see if the parameter is only meant to be shown on a results page #}
	<br>
	{# Code to generate actual searchui here #}
	{% if field.search_type == "input_box" %}
	{{onsInput({
		"id"   : field.database_name,
		"name" : field.database_name,
		"classes": field.classes if show else ' '.join([field.only_display_in_results_page,field.classes])  ,
		"label": { "text": field.display_title,
			   "classes": '' if show else field.only_display_in_results_page,
			   "description": '' if not show else field.description },
		"value": field.previous_value,   })}}
	{% elif field.search_type == "dropdown" %}

	{{onsSelect({
		"id"   : field.database_name,
		"name" : field.database_name,
		"classes": field.classes if show else ' '.join([field.only_display_in_results_page,field.classes])  ,
		"label": { "text": field.display_title, 
			   "classes": '' if show else field.only_display_in_results_page,
			   "description": field.description },
		"options": field.dropdown_options })}}
	{% elif field.search_type == "checkbox" %}

	{{onsCheckbox({
		"id": field.database_name,
		"name": field.database_name,
		"classes": field.classes if show else ' '.join([field.only_display_in_results_page,field.classes])  ,
		"label": { "text": field.display_title, 
			   "classes": '' if show else field.only_display_in_results_page,
			   "description": field.description },
		"value": True,
		"checked": field.checkbox_value, })}}
		<br>

	{% elif field.search_type == "radio" %}
	{% call onsQuestion({
	    "title": field.display_title,
	    "classes": 'u-mt-no' + '' if show else ' '.join([field.only_display_in_results_page,field.classes])  ,
	    "legendIsQuestionTitle": true }) %}
	{{ onsRadios({
            "name": field.database_name,
            "dontWrap": true,
            "radios": field.radio_options }) }}
	{% endcall %}

	{% elif field.search_type == "label" %}
	{{ onsLabel({
	    "id": 'label',
	    "for": "",
	    "classes": field.classes if show else ' '.join([field.only_display_in_results_page,field.classes])  ,
     	    "text": field.display_title, }) }}

	{% elif field.search_type == "autosuggest" %}
	 {{ onsAutosuggest({
            "id": field.database_name,
            "name": field.database_name,
	    "label": { "text": field.display_title, 
	 	   "classes": '' if show else field.only_display_in_results_page,
		   "description": field.description },
            "autocomplete": "off",
            "instructions": "Use up and down keys to navigate suggestions once you\'ve typed more than two characters. Use the enter key to select a suggestion. Touch device users, explore by touch or with swipe gestures.",
            "ariaYouHaveSelected": "You have selected",
            "ariaMinChars": "Enter 3 or more characters for suggestions.",
            "ariaResultsLabel": "Country suggestions",
            "ariaOneResult": "There is one suggestion available.",
            "ariaNResults": "There are {n} suggestions available.",
            "ariaLimitedResults": "Results have been limited to 10 suggestions. Type more characters to improve your search",
            "moreResults": "Continue entering to improve suggestions",
            "resultsTitle": "Suggestions",
            "autosuggestData": field.autosuggest_url,
            "noResults": "No suggestions found. You can enter your own answer",
            "typeMore": "Continue entering to get suggestions",
	    "allowMultiple": "true",
	    "value": field.previous_value,   
        }) }}

{% endif %}
{% endfor %}

<br>
{# Add a search button on the end of the UI #}
{% if not params.remove_buttons %}
{{  onsButton({ 
	"text": "Search", }) }}

{# Add a clear filters button with a url to the currently selected endpoint #}
{% for endpoint in params.endpoints %}
  {% if endpoint.selected %}
	{{ onsButton({
		'text': 'Clear  filters',
		'classes': 'btn--secondary',
		'submitType': "loader",
		'url': endpoint.url,
	}) }}
{% endif %}
{% endfor %}
{% endif %}

</section>

	



{% endmacro %}
